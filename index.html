<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Semua-Statistika by Briant Cua</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Slabo+27px&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Glory:ital,wght@0,100..800;1,100..800&family=Slabo+27px&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Economica:ital,wght@0,400;0,700;1,400;1,700&family=Glory:ital,wght@0,100..800&family=Slabo+27px&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    

    <style>
        .container {
            margin: auto;
            max-width: 800px;
            width: 100%;
        }

        h1 {
            font-family: 'Glory', serif;
            font-weight: 1000;
            color: #092b4d;
            transition: transform 0.3s ease-in-out;
            transform-origin: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        h1:hover {
            transform: scale(1.08);
        }

        h4 {
            font-family: 'Glory', serif;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .nav-tabs .nav-link {
            font-family: 'Montserrat', monospace;
            font-weight: 600;
            color: #69b3d7;
            transition: color 0.3s ease-in-out;
        }

        .form-label {
            font-family: 'Glory', serif;
            font-weight: 600;
            text-align: left;
            font-size: 120%;
        }

        h5 {
            font-family: 'Glory', serif;
            font-weight: 600;
            text-align: center;
            font-size: 160%;
        }

        #toggle_all {
            transform-origin: center;
            transition: transform 0.3s ease-in-out;
        }

        #toggle_all:hover {
            transform: scale(1.04);
        }

        #toggle_all:active {
            transform: scale(0.98);
        }

        body {
            padding: 20px;
            background-color: #f3f2dd;
            font-family: 'Inter', sans-serif;
            font-weight: bold;
        }

        .card, .table, #inputcard {
            width: 100%;
        }

        .card {
            margin-top: 10px;
            border-radius: 1rem;
            font-family: 'Montserrat', serif;
            font-weight: bold;
            background-color: #fdfff4;
        }

        #inputcard{
            padding: 10px; /* Reduce padding */
            margin-top: 10px; /* Adjust spacing above the card */    
        }

        canvas {
            max-width: 100% !important;
            width: 100% !important;
            height: auto !important;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            color: #888;
            font-size: 0.9rem;
            position: fixed, bottom;
        }

        .form-control {
            border-left: 5px solid #69b3d7;
            font-family: 'Montserrat', monospace;
            font-size: 1rem;
            background-color: #ffffffd8;
        }
        
        .btn-primary {
            background-color: #69b3d7;
            border-color: #69b3d7;
            font-family: 'Montserrat', monospace;
            font-size: 1rem;
            font-weight: bold;
            transition: background-color 0.3s ease;
            transition: transform 0.3s ease-in-out;
            transform-origin: center;
        }

        .btn-primary:hover {
            background-color: #5a9bcf;
            border-color: #5a9bcf;
            transform: scale(1.03);
        }

        .btn-primary:active {
            background-color: #42749d !important;
            border-color: #42749d !important;
            transform:scale(0.98);
        }

        #del {
            background-color: rgb(223, 11, 11)!important;
            border-radius: 0.375rem;
            font-family: 'Montserrat', monospace;
            font-size: 1rem;
            color: #eaeaea        !important;
            font-weight: bold;
            transition: background-color 0.3s ease;
            transition: transform 0.3s ease-in-out;
            transform-origin: center;
            margin-bottom: 0px;
            margin-top: 0px;
        }
        
        #del:hover {
            background-color: rgb(204, 8, 8) !important;
            border-color: rgb(204, 8, 8);
            transform: scale(1.09);
        }

        #del:active {
            background-color: rgb(179, 8, 8) !important;
            border-color: rgb(179, 8, 8) !important;
            transform:scale(0.98);
        }

        .btn-outline-secondary{
            background-color: #dac9a9e6;
            border-color: #dac9a9e6;
            font-family: 'Montserrat', monospace;
            font-size: 1rem;
            color: #212224;
            font-weight: bold;
            transition: background-color 0.3s ease;
            transition: transform 0.3s ease-in-out;
            transform-origin: center;
        }
        
        .btn-outline-secondary:hover {
            background-color: #dabe8be6 !important;
            border-color: #dabe8be6 !important;
            transform: scale(1.02);
        }

        .btn-outline-secondary:active {
            background-color: #dabe8b9e !important;
            border-color: #dabe8b9e !important;
            transform:scale(0.98);
        }

        table {
            width: 100%;
            overflow-x: scroll;
            border-radius: 0.375rem;
            margin-top: 5px;
            margin-bottom: 5px ;
        }

        #table-container {
            overflow-x: auto; /* Enable horizontal scrolling */
            max-width: 100%; /* Set a maximum width for the container */
        }

        th, td {
            text-align: center;
            padding: 0.5rem;
            border: 1px solid #faf9f6ba;
        }

        th {
            background-color: #a2b0c0;
            color: rgb(245, 241, 226);
        }
    
        #dataInput table {
            border-collapse: collapse;
            border-radius: 0.375rem;
        }

        #dataInput th, #dataInput td {
            border: 1px solid #ccc;
            padding: 8px;
        }

        #dataInput input[type="number"] {
            
            width: 95%;
            min-width: 80px;
            max-width: 100%;
            display: inline-block;
        }

        @media (max-width: 767.98px) {
            #dataInput input[type="number"] {
                width: 100px;
            }
        }

        #dataInput button {
            margin-top: 10px;
        }

        #excelFileInput {
            display: none;
        }

        #customFileLabel{
            background: #e3f2fd;
            border: 2px dashed #69b3d7;
            border-radius: 0.375rem;
            color: #092b4d;
            font-family: 'Montserrat', monospace;
            font-size: 1rem;
            font-weight: bold;
            width: 100%;
            display: inline-block;
            text-align: center;
            padding: 0.5rem 0;
            margin-bottom: 2px;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }

        .input-group-text {
            background-color: #e3f2fd;
            border: 2px dashed #69b3d7;
            border-radius: 0.375rem;
            color: #092b4d;
            font-family: 'Montserrat', monospace;
            font-size: 1rem;
            font-weight: bold;
            padding: 0.5rem 1rem;
        }

        #descRawToTableBtn {
            background-color: #e3f2fd;
            border: 2px dashed #69b3d7;
            border-radius: 0.375rem;
            color: #092b4d;
            font-family: 'Montserrat', monospace;
        }

        #descRawToTableBtn:hover {
            background-color: #69b3d7!important;
            border-color: #69b3d7!important;
            color: #e3f2fd;
            transform: scale(1.00);
            transition: background 0.2s, color 0.2s;
        }
        
        #customFileLabel:hover {
            background: #69b3d7;
            color: #fff;
        }
        
        #fileNameDisplay {
            font-family: 'Courier New', Courier, monospace;
            display: block;
            text-align: center;
            font-size: 0.95rem;
            background-color: rgba(194, 189, 189, 0.5); /* 0.5 = 50% opacity */
            backdrop-filter: blur(2px);
            color: #555;
            margin-bottom: 8px;
            border-radius: 0.375rem;
        }

        @media (max-width: 767.98px) {
            h1 {
                font-size: 1.5rem;
            }
            h4, h5 {
                font-size: 1.1rem;
            }
            .card, #inputcard {
                padding: 0.5rem !important;
            }
            .form-label, .form-control {
                font-size: 0.95rem;
            }
            .btn, .btn-primary, .btn-outline-secondary {
                font-size: 0.95rem;
                padding: 0.4rem 0.6rem;
            }
            #dataInput input[type="number"] {
                width: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="container" >
        <h1 class="mb-4 text-center" >SEMUA - STATISTIKA</h1>

        <!-- Main Tabs: Regresi / Deskriptif -->
        <ul class="nav nav-tabs mb-3" id="mainTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="regresi-tab" data-bs-toggle="tab" data-bs-target="#regresi-tab-pane" type="button" role="tab" aria-controls="regresi-tab-pane" aria-selected="true">Regresi</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="deskriptif-tab" data-bs-toggle="tab" data-bs-target="#deskriptif-tab-pane" type="button" role="tab" aria-controls="deskriptif-tab-pane" aria-selected="false">Deskriptif</button>
            </li>
        </ul>
        <div class="tab-content" id="mainTabContent">

            <!-- Regresi Tab Content -->
            <div class="tab-pane fade show active" id="regresi-tab-pane" role="tabpanel" aria-labelledby="regresi-tab">
                <!-- Input Card (Data Entry) -->
                <div id="inputcard" class="card p-4 shadow-sm mb-3">
                    <div id="dataInput">
                        <h4>Masukkan Data X dan Y:</h4>
                        <input type="file" id="excelFileInput" accept=".xlsx,.xls" />
                        <label for="excelFileInput" id="customFileLabel">Pilih File Excel</label>
                        <span id="fileNameDisplay"></span>
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>X</th>
                                        <th>Y</th>
                                    </tr>
                                </thead>
                                <tbody id="dataTableBody">
                                    <tr>
                                        <td><input type="number" class="form-control x-value" tabindex="-1"></td>
                                        <td><input type="number" class="form-control y-value" tabindex="-1"></td>
                                    </tr>
                                    <tr>
                                        <td><input type="number" class="form-control x-value" tabindex="-1"></td>
                                        <td><input type="number" class="form-control y-value" tabindex="-1"></td>
                                    </tr>
                                    <tr>
                                        <td><input type="number" class="form-control x-value" tabindex="-1"></td>
                                        <td><input type="number" class="form-control y-value" tabindex="-1"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <button  type="button" name="delete" class="btn btn-danger btn-sm mt-2" id="del" onclick="deleteRegRow()">Hapus Baris</button>
                    </div>
                    <button data-mdb-button-init data-mdb-ripple-init class="btn btn-primary w-100 mt-3" data-mdb-toggle="button" autocomplete="off" onclick="hitungSemua();show('statistik');show('kesimpulan');show('regresi');show('plot')"  >Hitung</button>
                </div>
                <!-- Result Toggle Buttons and Results (Regresi) -->
                <div class="card p-4 shadow-sm mb-3">
                    <h5 class="mb-3" id="toggle_all" onclick="toggle('statistik');toggle('kesimpulan');toggle('regresi');toggle('plot')">Tampilkan/Hilangkan Hasil</h5>
                    <div class="row g-2">
                        <div class="col-6 col-md-3">
                            <button class="btn btn-outline-secondary w-100" onclick="toggle('statistik')">Statistik</button>
                        </div>
                        <div class="col-6 col-md-3">
                            <button class="btn btn-outline-secondary w-100" onclick="toggle('kesimpulan')">Kesimpulan</button>
                        </div>
                        <div class="col-6 col-md-3">
                            <button class="btn btn-outline-secondary w-100" onclick="toggle('regresi')">Regresi</button>
                        </div>
                        <div class="col-6 col-md-3">
                            <button class="btn btn-outline-secondary w-100" onclick="toggle('plot')">Scatter Plot</button>
                        </div>
                    </div>
                </div>
                <div id="statistik" class="card p-4 shadow-sm mt-3 d-none"></div>
                <div id="kesimpulan" class="card p-4 shadow-sm mt-3 d-none"></div>
                <div id="regresi" class="card p-4 shadow-sm mt-3 d-none"></div>
                <div id="plot" class="card p-4 shadow-sm mt-3 d-none">
                    <canvas id="scatterChart" style="width:100%;"></canvas>
                </div>
            </div>

            <!-- Deskriptif Tab Content -->
            <div class="tab-pane fade" id="deskriptif-tab-pane" role="tabpanel" aria-labelledby="deskriptif-tab">
                <div id="inputcard" class="card p-4 shadow-sm mb-3">
                    <div class="mb-2">
                        <h4>Input Data Mentah:</h4>
                        <input type="text" id="descRawInput" class="form-control mb-2" placeholder="Contoh: 1, 2, 2, 3, 4">
                    </div>
                    <div class="mb-2">
                        <button class="btn btn-outline-secondary btn-sm mb-2" id="descRawToTableBtn">Masukkan ke Tabel</button>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered" id="descTable">
                            <thead>
                                <tr>
                                    <th>Nilai</th>
                                    <th>Frekuensi</th>
                                </tr>
                            </thead>
                            <tbody id="descTableBody">
                                <tr>
                                    <td><input type="number" class="form-control desc-x-value"></td>
                                    <td><input type="number" class="form-control desc-y-value" value="1"></td>
                                </tr>
                            </tbody>
                        </table>
                        <button  type="button" name="delete2" class="btn btn-danger btn-sm mt-2" id="del" onclick="deleteDescRow()">Hapus Baris</button>
                    </div>
                    <button class="btn btn-primary w-100 mt-3" id="descStatBtn">Hitung</button>
                </div>
                <div class="card p-4 shadow-sm mb-3" id="descGroupedCard">
                    <h5>Tabel Data Kelompok</h5>
                    <div id="descGroupedTable"></div>
                </div>
                <div id="descStatResult" class="mt-3"></div>
            </div>
        </div>
    </div>

    <script>
        let chart;

        function toggle(id) {
            document.getElementById(id).classList.toggle('d-none');
        }

        function show(id) {
            document.getElementById(id).classList.remove('d-none');
        }

        function focusNextVerticalReg(currentInput) {
            const row = currentInput.closest('tr');
            const table = document.getElementById('dataTableBody');
            let nextInput = null;
            let colClass = currentInput.classList.contains('x-value') ? 'x-value' : 'y-value';
            let currentRow = row;
            while (currentRow) {
                const nextRow = currentRow.nextElementSibling;
                if (nextRow) {
                    nextInput = nextRow.querySelector('.' + colClass);
                    if (nextInput) break;
                }
                currentRow = nextRow;
            }
            if (!nextInput) {
                addRow();
                const newRow = table.lastElementChild;
                nextInput = newRow.querySelector('.' + colClass);
            }
            if (nextInput) {
                nextInput.focus();
            }
        }

        function handleEnter(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                focusNextVerticalReg(event.target);
            }
        }

        function attachVerticalNavReg(input) {
            input.addEventListener('keypress', handleEnter);
            // Only move vertically on change if the input is not empty and there IS a next row
            input.addEventListener('change', function(e) {
                if (e.target.value !== '') {
                    const row = e.target.closest('tr');
                    const colClass = e.target.classList.contains('x-value') ? 'x-value' : 'y-value';
                    const nextRow = row.nextElementSibling;
                    // Only move vertically if there is a next row (prevents new row on horizontal move)
                    if (nextRow && nextRow.querySelector('.' + colClass)) {
                        setTimeout(() => focusNextVerticalReg(e.target), 20);
                    }
                }
            });
        }

        function addRow() {
            const tableBody = document.getElementById('dataTableBody');
            const newRow = tableBody.insertRow();
            const cellX = newRow.insertCell();
            const cellY = newRow.insertCell();
            cellX.innerHTML = '<input type="number" class="form-control x-value" tabindex="-1">';
            cellY.innerHTML = '<input type="number" class="form-control y-value" tabindex="-1">';
            const xInput = cellX.querySelector('input');
            const yInput = cellY.querySelector('input');
            attachVerticalNavReg(xInput);
            attachVerticalNavReg(yInput);
        }

        // Attach event listeners to the initial input fields
        window.onload = function() {
            const initialXInputs = document.querySelectorAll('#dataTableBody .x-value');
            const initialYInputs = document.querySelectorAll('#dataTableBody .y-value');

            initialXInputs.forEach(input => attachVerticalNavReg(input));
            initialYInputs.forEach(input => attachVerticalNavReg(input));
        };

        function deleteRegRow() {
            const tableBody = document.getElementById('dataTableBody');
            if (tableBody.rows.length > 1) {
                tableBody.deleteRow(-1);
            } else {
                alert('Minimal harus ada 1 baris data.');
            }
        }

        function parseTableInput() {
            const xValues = [];
            const yValues = [];
            const xInputs = document.querySelectorAll('#dataTableBody .x-value');
            const yInputs = document.querySelectorAll('#dataTableBody .y-value');

            xInputs.forEach(input => {
                const value = parseFloat(input.value.replace(',', '.'));
                if (!isNaN(value)) {
                    xValues.push(value);
                }
            });

            yInputs.forEach(input => {
                const value = parseFloat(input.value.replace(',', '.'));
                if (!isNaN(value)) {
                    yValues.push(value);
                }
            });

            if (xValues.length !== yValues.length) {
                alert('Jumlah nilai X dan Y tidak sama.');
                return { x: [], y: [], valid: false };
            }
            if (xValues.length === 0 || yValues.length === 0) {
                alert('Mohon masukkan setidaknya satu pasang nilai X dan Y.');
                return { x: [], y: [], valid: false };
            }

            return { x: xValues, y: yValues, valid: true };
        }

        function formatNumber(num) {
            return num.toFixed(2).replace('.', ',');
        }

        // Add global variables to store regression coefficients
        defaultPredictX = '';
        window.regressionCoefficients = { a: 0, b: 0 };

        function predict() {
            const xInput = document.getElementById('predictXInput');
            let x = xInput ? parseFloat(xInput.value.replace(',', '.')) : NaN;
            if (isNaN(x)) return '';
            const { a, b } = window.regressionCoefficients;
            return formatNumber(b * x + a);
        }

        function hitungSemua() {
            const data = parseTableInput();

            if (!data.valid) {
                return;
            }

            const x = data.x;
            const y = data.y;
            const n = x.length;

            const meanX = x.reduce((a, b) => a + b, 0) / n;
            const meanY = y.reduce((a, b) => a + b, 0) / n;

            let Sxx = 0, Syy = 0, Sxy = 0, sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0, sumY2 = 0;
            let SSE = 0, SSR = 0, SST = 0;
            let tableRows = '';

            for (let i = 0; i < n; i++) {
                const xi = x[i];
                const yi = y[i];
                const xi2 = xi ** 2;
                const yi2 = yi ** 2;
                const xyi = xi * yi;
                sumX += xi;
                sumY += yi;
                sumXY += xyi;
                sumX2 += xi2;
                sumY2 += yi2;
            }

            const b = parseFloat(((n * sumXY - sumX * sumY) / (n * sumX2 - sumX ** 2)).toFixed(2));
            const a = parseFloat(((sumY * sumX2 - sumX * sumXY) / (n * sumX2 - sumX ** 2)).toFixed(2));
            window.regressionCoefficients = { a, b };

            for (let i = 0; i < n; i++) {
                const count = parseFloat((i+1).toFixed(0));
                const xi = x[i];
                const yi = y[i];
                const yiHat = a + (b * xi);
                const subSSE = (yi - yiHat) ** 2;
                const subSSR = (yiHat - meanY) ** 2;
                SSE += subSSE;
                SSR += subSSR;
                SST += subSSE + subSSR;
                tableRows += `<tr>
                    <td>${count}</td>
                    <td>${formatNumber(xi)}</td>
                    <td>${formatNumber(yi)}</td>
                    <td>${formatNumber(xi * yi)}</td>
                    <td>${formatNumber(xi ** 2)}</td>
                    <td>${formatNumber(yi ** 2)}</td>
                    <td>${formatNumber(yiHat)}</td>
                    <td>${formatNumber(subSSR)}</td>
                    <td>${formatNumber(subSSE)}</td>
                    </tr>`;
            }

            tableRows += `<tr>
                <td><strong>Total</strong></td>
                <td><strong>Î£x = ${formatNumber(sumX)}</strong></td>
                <td><strong>Î£y = ${formatNumber(sumY)}</strong></td>
                <td><strong>Î£xy = ${formatNumber(sumXY)}</strong></td>
                <td><strong>Î£xÂ² = ${formatNumber(sumX2)}</strong></td>
                <td><strong>Î£yÂ² = ${formatNumber(sumY2)}</strong></td>
                <td></td>
                <td><strong>SSR = ${formatNumber(SSR)}</strong></td>
                <td><strong>SSE = ${formatNumber(SSE)}</strong></td>
                </tr>`

            const r = (n * sumXY - sumX * sumY) / Math.sqrt((n * sumX2 - sumX ** 2) * (n * sumY2 - sumY ** 2));
            const r2 = r ** 2;
            const points = x.map((xi, i) => ({ x: xi, y: y[i] }));
            const Sest = Math.sqrt(SSE / (n - 2));

            // Line through the regression equation
            const minX = Math.min(...x);
            const maxX = Math.max(...x);
            const regressionLine = [
                { x: minX, y: a + b * minX },
                { x: maxX, y: a + b * maxX }
            ];
            
            document.getElementById('statistik').innerHTML = 
            `   
                <h5>ðŸ“ŠStatistik</h5>
                <div id="table-container">
                <table class="table table-striped w-100">
                    <th>No.</th><th>x</th><th>y</th><th>xy</th><th>xÂ²</th><th>yÂ²</th><th>Å·</th><th>(Å·-È³)Â²</th><th>(y-Å·)Â²</th></tr></thead>
                    <tbody>${tableRows}</tbody>
                </table>
                </div>
                <h4>Koefisien Korelasi Pearson (r): ${formatNumber(r)}</h4>
                <ul>
                    <li>SST: ${formatNumber(SST)}</li>
                    <li>Koefisien Determinasi (rÂ²): ${formatNumber(r2)}</li>
                    <li>Kesalahan Standar Estimasi (Sest): ${formatNumber(Sest)}</li>
                </ul>
            `;

            const kesimpulan =
                r === 0 ? 'Tidak ada korelasi.' :
                (r > -0.3 && r <= 0) || (r > 0 && r <= 0.3) ? 'Lemah. Tidak disarankan untuk prediksi.' :
                (r > -0.7 && r <= -0.3) || (r > 0.3 && r <= 0.7) ? 'Sedang/Cukup. Tidak disarankan untuk prediksi.' :
                (r > -1 && r <= -0.7) || (r > 0.7 && r < 1) ? 'Kuat. Boleh dilakukan prediksi.' :
                (r === -1 || r === 1) ? 'Sempurna.' :
                'Tidak ada input yang valid.';

            document.getElementById('kesimpulan').innerHTML = `
                <h5>ðŸ“ŒKesimpulan</h5>
                <p>Korelasi antara x dan y adalah <strong>${formatNumber(r)}</strong>. ${kesimpulan}</p>
            `;

            document.getElementById('regresi').innerHTML = `
                <h5>ðŸ“ˆPersamaan Regresi</h5>
                <h4>y = ${formatNumber(b)}x + ${formatNumber(a)}</h4>
                <p>Koefisien Korelasi Pearson (r): ${formatNumber(r)}</p>
                <p><strong>a</strong> (intersep): ${formatNumber(a)}</p>
                <p><strong>b</strong> (kemiringan): ${formatNumber(b)}</p>
                <div class="input-group mb-2" style="max-width:335px;">
                    <span class="input-group-text">x</span>
                    <input type="number" class="form-control" id="predictXInput" placeholder="Masukkan x untuk prediksi" oninput="document.getElementById('predictYOutput').textContent = predict();">
                </div>
                <h4>Prediksi y: <span id="predictYOutput"></span></h4>
            `;

            if (chart) chart.destroy();
            const ctx = document.getElementById('scatterChart');
            chart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Data',
                            data: points,
                            backgroundColor: 'rgba(13, 110, 253, 0.8)',
                            pointRadius: 5,
                            showLine: false
                        },
                        {
                            label: 'Regresi',
                            data: regressionLine,
                            borderColor: 'rgba(220, 53, 69, 1)',
                            borderWidth: 2,
                            type: 'line',
                            pointRadius: 0,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: { display: true, text: 'X' }
                        },
                        y: {
                            title: { display: true, text: 'Y' }
                        }
                    }
                }
            });
        }

    
        // Excel upload handler
        document.getElementById('excelFileInput').addEventListener('change', function(e) {
            const fileName = e.target.files[0] ? e.target.files[0].name : '';
            document.getElementById('fileNameDisplay').textContent = fileName;
            // ...existing code for reading the file...
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const rows = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                // Clear existing table
                const tableBody = document.getElementById('dataTableBody');
                tableBody.innerHTML = '';
                // Assume first row is header, start from second row
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (row.length >= 2) {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td><input type="number" class="form-control x-value" value="${row[0]}" tabindex="-1"></td>
                            <td><input type="number" class="form-control y-value" value="${row[1]}" tabindex="-1"></td>
                        `;
                        tableBody.appendChild(tr);
                    }
                }
                // Re-attach vertical navigation
                const xInputs = document.querySelectorAll('#dataTableBody .x-value');
                const yInputs = document.querySelectorAll('#dataTableBody .y-value');
                xInputs.forEach(input => attachVerticalNavReg(input));
                yInputs.forEach(input => attachVerticalNavReg(input));
            };
            reader.readAsArrayBuffer(file);
        });
    </script>
    <script>
        // --- Deskriptif Tab Logic ---
        function addDescRow(x = '', y = 1) {
            const tbody = document.getElementById('descTableBody');
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><input type="number" class="form-control desc-x-value" value="${x}"></td>
                <td><input type="number" class="form-control desc-y-value" value="${y}"></td>
            `;
            tbody.appendChild(tr);
        }
        function clearDescTable() {
            const tbody = document.getElementById('descTableBody');
            tbody.innerHTML = '';
        }
        function parseDescRawInput() {
            const val = document.getElementById('descRawInput').value;
            let arr = val.split(/,|\s|;/).map(x => parseFloat(x.replace(',', '.'))).filter(x => !isNaN(x));
            return arr;
        }
        function fillDescTableFromRaw() {
            const arr = parseDescRawInput();
            if (!arr.length) return;
            // Build frequency from current table
            const tbody = document.getElementById('descTableBody');
            const xInputs = tbody.querySelectorAll('.desc-x-value');
            const yInputs = tbody.querySelectorAll('.desc-y-value');
            const freq = {};
            for (let i = 0; i < xInputs.length; i++) {
                let x = parseFloat(xInputs[i].value);
                let y = parseInt(yInputs[i].value);
                if (!isNaN(x) && !isNaN(y) && y > 0) {
                    freq[x] = (freq[x] || 0) + y;
                }
            }
            // Add new input
            arr.forEach(x => freq[x] = (freq[x] || 0) + 1);
            // Clear and re-render table
            clearDescTable();
            Object.entries(freq).forEach(([x, y]) => addDescRow(x, y));
        }
        
        function deleteDescRow() {
            const tableBody = document.getElementById('descTableBody');
            if (tableBody.rows.length > 1) {
                tableBody.deleteRow(-1);
            } else {
                alert('Minimal harus ada 1 baris data.');
            }
        }

        // --- Deskriptif Table Vertical Navigation ---
        function focusNextVerticalDesc(currentInput) {
            const row = currentInput.closest('tr');
            const table = document.getElementById('descTableBody');
            let nextInput = null;
            let colClass = currentInput.classList.contains('desc-x-value') ? 'desc-x-value' : 'desc-y-value';
            let currentRow = row;
            while (currentRow) {
                const nextRow = currentRow.nextElementSibling;
                if (nextRow) {
                    nextInput = nextRow.querySelector('.' + colClass);
                    if (nextInput) break;
                }
                currentRow = nextRow;
            }
            if (!nextInput) {
                addDescRow();
                const newRow = table.lastElementChild;
                nextInput = newRow.querySelector('.' + colClass);
            }
            if (nextInput) {
                nextInput.focus();
            }
        }

        function handleEnterDesc(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                focusNextVerticalDesc(event.target);
            }
        }

        function attachVerticalNavDesc(input) {
            input.addEventListener('keypress', handleEnterDesc);
            input.addEventListener('change', function(e) {
                if (e.target.value !== '') {
                    const row = e.target.closest('tr');
                    const colClass = e.target.classList.contains('desc-x-value') ? 'desc-x-value' : 'desc-y-value';
                    const nextRow = row.nextElementSibling;
                    if (nextRow && nextRow.querySelector('.' + colClass)) {
                        setTimeout(() => focusNextVerticalDesc(e.target), 20);
                    }
                }
            });
        }

        // Attach to initial Deskriptif inputs on load
        window.addEventListener('DOMContentLoaded', function() {
            const initialXInputs = document.querySelectorAll('#descTableBody .desc-x-value');
            const initialYInputs = document.querySelectorAll('#descTableBody .desc-y-value');
            initialXInputs.forEach(input => attachVerticalNavDesc(input));
            initialYInputs.forEach(input => attachVerticalNavDesc(input));
        });

        // Patch addDescRow to attach navigation
        const _addDescRow = addDescRow;
        addDescRow = function(x = '', y = 1) {
            _addDescRow(x, y);
            const tbody = document.getElementById('descTableBody');
            const lastRow = tbody.lastElementChild;
            if (lastRow) {
                const xInput = lastRow.querySelector('.desc-x-value');
                const yInput = lastRow.querySelector('.desc-y-value');
                if (xInput) attachVerticalNavDesc(xInput);
                if (yInput) attachVerticalNavDesc(yInput);
            }
        }

        document.getElementById('descRawToTableBtn').addEventListener('click', fillDescTableFromRaw);
        document.getElementById('descRawInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                fillDescTableFromRaw();
                e.preventDefault();
            }
        });

        function parseDescTable() {
            const xInputs = document.querySelectorAll('#descTableBody .desc-x-value');
            const yInputs = document.querySelectorAll('#descTableBody .desc-y-value');
            let arr = [];
            for (let i = 0; i < xInputs.length; i++) {
                let x = parseFloat(xInputs[i].value);
                let y = parseInt(yInputs[i].value);
                if (!isNaN(x) && !isNaN(y) && y > 0) {
                    for (let j = 0; j < y; j++) arr.push(x);
                }
            }
            return arr;
        }
        function mean(arr) {
            if (!arr.length) return 0;
            return arr.reduce((a, b) => a + b, 0) / arr.length;
        }
        function median(arr) {
            if (!arr.length) return 0;
            let s = [...arr].sort((a, b) => a - b);
            let mid = Math.floor(s.length / 2);
            return s.length % 2 ? s[mid] : (s[mid - 1] + s[mid]) / 2;
        }
        function mode(arr) {
            if (!arr.length) return [];
            let freq = {};
            arr.forEach(x => freq[x] = (freq[x] || 0) + 1);
            let max = Math.max(...Object.values(freq));
            let modes = Object.keys(freq).filter(k => freq[k] === max).map(Number);
            if (modes.length === Object.keys(freq).length) return [];
            return modes;
        }
        function quartiles(arr) {
            if (!arr.length) return {Q1:0, Q2:0, Q3:0};
            let s = [...arr].sort((a, b) => a - b);
            let Q2 = median(s);
            let mid = Math.floor(s.length / 2);
            let lower = s.slice(0, mid);
            let upper = s.length % 2 ? s.slice(mid + 1) : s.slice(mid);
            let Q1 = median(lower);
            let Q3 = median(upper);
            return { Q1, Q2, Q3 };
        }
        function stdev(arr) {
            if (!arr.length) return 0;
            let m = mean(arr);
            let v = arr.reduce((a, b) => a + (b - m) ** 2, 0) / arr.length;
            return Math.sqrt(v);
        }
        function renderDescStat(arr) {
            if (!arr.length) {
                document.getElementById('descStatResult').innerHTML = '<div class="alert alert-warning">Nilai tidak boleh kosong.</div>';
                return;
            }
            let n = arr.length;
            let min = Math.min(...arr);
            let max = Math.max(...arr);
            let range = max - min;
            let m = mean(arr);
            let med = median(arr);
            let mod = mode(arr);
            let q = quartiles(arr);
            let sd = stdev(arr);
            document.getElementById('descStatResult').innerHTML = `
            </div>
                <div class="card p-4 shadow-sm mt-3">
                    <ul>
                        <li>Banyak Data (n) : ${n}</li>
                        <li>Nilai Minimum   : ${min}</li>
                        <li>Nilai Maksimum  : ${max}</li>
                        <li>Range           : ${range}</li>
                        <li>Mean (Rata-rata): ${formatNumber(m)}</li>
                        <li>Median          : ${formatNumber(med)}</li>
                        <li>Modus           : ${formatNumber(mod.length) ? mod.join(', ') : 'Tidak ada (semua nilai unik)'}</li>
                        <li>Q1 (Kuartil 1)  : ${formatNumber(q.Q1)}</li>
                        <li>Q2 (Median)     : ${formatNumber(q.Q2)}</li>
                        <li>Q3 (Kuartil 3)  : ${formatNumber(q.Q3)}</li>
                        <li>Standar Deviasi : ${formatNumber(sd)}</li>
                    </ul>
                </div>
            `;
        }
        document.getElementById('descStatBtn').addEventListener('click', function() {
            let arr = parseDescTable();
            renderDescStat(arr);
            showDescResults();
        });
        function renderGroupedTable() {
            const xInputs = document.querySelectorAll('#descTableBody .desc-x-value');
            const yInputs = document.querySelectorAll('#descTableBody .desc-y-value');
            let data = [];
            for (let i = 0; i < xInputs.length; i++) {
                let x = parseFloat(xInputs[i].value);
                let y = parseInt(yInputs[i].value);
                if (!isNaN(x) && !isNaN(y) && y > 0) {
                    data.push({ x, f: y });
                }
            }
            const card = document.getElementById('descGroupedCard');
            if (data.length === 0) {
                card.classList.add('d-none');
                document.getElementById('descGroupedTable').innerHTML = '';
                return;
            } else {
                card.classList.remove('d-none');
            }
            // Sort by x
            data.sort((a, b) => a.x - b.x);
            // Find min, max, n, and number of classes (Sturges' rule)
            const min = data[0].x;
            const max = data[data.length - 1].x;
            const n = data.reduce((acc, d) => acc + d.f, 0);
            const k = Math.round(1 + 3.322 * Math.log10(n));
            const range = max - min;
            const interval = Math.ceil(range / k);
            // Build grouped table
            let rows = '';
            let lower = min;
            let totalFx = 0;
            for (let i = 0; i < k; i++) {
                let upper = lower + interval;
                // Format as 1-3, 4-6, etc.
                let kelas = `${lower}-${upper - 1}`;
                // Sum frequencies in this class
                let freq = 0;
                let fx = 0;
                let mid = (lower + upper - 1) / 2;
                data.forEach(d => {
                    if (d.x >= lower && d.x < upper) {
                        freq += d.f;
                        fx += d.f * mid;
                    }
                });
                totalFx += fx;
                rows += `<tr><td>${i + 1}</td><td>${kelas}</td><td>${freq}</td><td>${mid}</td><td>${fx}</td></tr>`;
                lower = upper;
            }
            document.getElementById('descGroupedTable').innerHTML = `
                <div class="table-responsive">
                <table class="table table-bordered">
                    <thead><tr><th>Kelas</th><th>Rentang</th><th>Frekuensi</th><th>Titik Tengah</th><th>f.xÌ„</th></tr></thead>
                    <tbody>${rows}</tbody>
                    <tfoot><tr><td colspan="4"><strong>Total f.xÌ„</strong></td><td><strong>${totalFx}</strong></td></tr></tfoot>
                </table>
                </div>
            `;
        }
        // Attach to changes in descTableBody
        const descTableBody = document.getElementById('descTableBody');
        descTableBody.addEventListener('input', renderGroupedTable);
        renderGroupedTable();

        // Add show/hide logic for deskriptif tab results
        function showDesc(id) {
            document.getElementById(id).classList.remove('d-none');
        }
        function toggleDesc(id) {
            document.getElementById(id).classList.toggle('d-none');
        }

        // Patch Deskriptif tab: hide grouped card and stat result by default
        window.addEventListener('DOMContentLoaded', function() {
            document.getElementById('descGroupedCard').classList.add('d-none');
            document.getElementById('descStatResult').classList.add('d-none');
            renderGroupedTable(); // Ensure initial state is correct
        });
        // Show on hitung
        function showDescResults() {
            showDesc('descGroupedCard');
            showDesc('descStatResult');
            // Also force renderGroupedTable to update and show the card if there is data
            renderGroupedTable();
        }
    </script>
    <footer><p></p></footer>
</body>
</html>
